<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>常北ファーム</title>
<style>
  body { font-family: sans-serif; margin: 0; background: #fafafa; }
  header { background: #222; color: white; padding: 10px; text-align: center; cursor: pointer; } /* ← クリック可能に */
  nav { display: flex; justify-content: space-around; background: #444; }
  nav button { flex: 1; padding: 10px; border: none; color: white; background: #444; cursor: pointer; }
  nav button.active { background: #666; }
  section { display: none; padding: 15px; }
  section.active { display: block; }
  input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
  textarea { height: 120px; }
  .list-item { padding: 8px; border-bottom: 1px solid #ccc; cursor: pointer; }
  .list-item:hover { background: #eee; }
</style>
</head>
<body>
<header onclick="openListTab()"> <!-- ← ヘッダークリックで昆虫リストに戻る -->
  <h1>常北ファーム</h1>
</header>
<nav>
  <button class="tab active" data-target="list">昆虫リスト</button>
  <button class="tab" data-target="farm">常北ファーム</button>
  <button class="tab" data-target="admin">管理者</button>
</nav>

<section id="list" class="active">
  <h2>昆虫リスト</h2>
  <div id="insectList"></div>

  <button id="addButton" onclick="addInsect()">＋ 新しい昆虫を追加</button>

  <div id="memoForm" style="display:none;">
    <h3 id="memoTitle"></h3>
    <form id="memoFields"></form>
    <button type="button" onclick="saveMemo()">保存</button>
    <button type="button" onclick="backToList()">戻る</button>
  </div>
</section>

<section id="farm">
  <iframe src="https://planet-studios-syros.com" style="width:100%; height:80vh; border:none;"></iframe>
</section>

<section id="admin">
  <p>管理者のページを開いています...</p>
  <p><a href="https://x.com/zebradovelab" target="_blank">X（旧Twitter）を開く</a></p>
</section>

<script>
// --- データ構造 ---
const fields = [
  "産地", "累代", "孵化", "1本目", "2本目", "3本目",
  "羽化", "休眠期間", "ペアリング1", "ペアリング2", "ペアリング3",
  "割出し1", "割出し2", "割出し3", "メモ"
];
let insects = JSON.parse(localStorage.getItem("insects") || "[]");
let currentIndex = null;

// --- 初期表示 ---
renderList();

// --- 昆虫リスト表示 ---
function renderList() {
  const list = document.getElementById("insectList");
  list.innerHTML = "";
  insects.forEach((insect, i) => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.textContent = `${i + 1}. ${insect.name} - ${insect.memo["産地"] || ""}`;
    div.onclick = () => openMemo(i);
    list.appendChild(div);
  });
}

// --- 昆虫追加 ---
function addInsect() {
  const name = prompt("昆虫の名前を入力:");
  if (!name) return;
  insects.push({ name, memo: {} });
  saveInsects();
  renderList();
  openMemo(insects.length - 1);
}

// --- メモ開く ---
function openMemo(index) {
  currentIndex = index;
  const insect = insects[index];
  document.getElementById("insectList").style.display = "none";
  document.getElementById("addButton").style.display = "none";
  document.querySelector("#memoForm").style.display = "block";
  document.querySelector("#memoTitle").textContent = `${index + 1}. ${insect.name}`;
  const form = document.getElementById("memoFields");
  form.innerHTML = "";
  fields.forEach(f => {
    const label = document.createElement("label");
    label.textContent = f;
    const input = f === "メモ" ? document.createElement("textarea") : document.createElement("input");
    input.value = insect.memo[f] || "";
    input.dataset.field = f;
    form.appendChild(label);
    form.appendChild(input);
  });
}

// --- メモ保存 ---
function saveMemo() {
  const inputs = document.querySelectorAll("#memoFields input, #memoFields textarea");
  const memo = {};
  inputs.forEach(el => { memo[el.dataset.field] = el.value; });
  insects[currentIndex].memo = memo;
  saveInsects();
  backToList();
}

// --- 戻る ---
function backToList() {
  document.getElementById("insectList").style.display = "block";
  document.getElementById("addButton").style.display = "inline-block";
  document.querySelector("#memoForm").style.display = "none";
  renderList();
}

// --- ローカル保存 ---
function saveInsects() {
  localStorage.setItem("insects", JSON.stringify(insects));
}

// --- タブ切替 ---
document.querySelectorAll(".tab").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    btn.classList.add("active");
    const target = btn.dataset.target;
    document.getElementById(target).classList.add("active");

    if (target === "admin") {
      window.open("https://x.com/zebradovelab", "_blank");
    }

    if (target === "list") {
      document.getElementById("insectList").style.display = "block";
      document.getElementById("addButton").style.display = "inline-block";
      document.querySelector("#memoForm").style.display = "none";
    }
  });
});

// ✅ ヘッダー「常北ファーム」クリックで昆虫リストに戻る
function openListTab() {
  document.querySelector('[data-target="list"]').click();
}
</script>
</body>
</html>


